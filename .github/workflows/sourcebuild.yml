- name: Get Last Merge Commit
        id: last_merge
        run: echo "::set-output name=commit::$(git log main --merges -1 --format=%H)"

      - name: Get Previous Merge Commit
        id: prev_merge
        run: echo "::set-output name=commit::$(git log main --merges -2 --format=%H)"

      - name: List Changed Files
        id: changed_files
        run: echo "::set-output name=files::$(git diff --name-only ${{ steps.prev_merge.outputs.commit }} ${{ steps.last_merge.outputs.commit }})"

      - name: Extract Directories
        id: changed_dirs
        run: |
          CHANGED_FILES="${{ steps.changed_files.outputs.files }}"
          DIRS=$(for file in $CHANGED_FILES; do dirname $file; done | sort | uniq)
          echo "::set-output name=dirs::$DIRS"

      - id: detect
        run: |
          CHANGED_FUNCTIONS=()
          CHANGED_DIRS="${{ steps.changed_dirs.outputs.dirs }}"
          for DIR in CHANGED_DIRS; do
              FUNCTION_NAME=$(basename $DIR)
              # Assuming entry point can be derived from function name
              ENTRY_POINT="${FUNCTION_NAME}"
              CHANGED_FUNCTIONS+=("{\"name\": \"$FUNCTION_NAME\", \"entry_point\": \"$ENTRY_POINT\"}")
          done
          if [ ${#CHANGED_FUNCTIONS[@]} -eq 0 ]; then
            echo "changed-functions=[]" >> $GITHUB_OUTPUT
          else
            CHANGED_FUNCTIONS_JSON=$(printf '[%s]' "$(IFS=,; echo "${CHANGED_FUNCTIONS[*]}")")
            echo "changed-functions=$CHANGED_FUNCTIONS_JSON" >> $GITHUB_OUTPUT
          fi